<div class="voice-container">
  <!-- Feedback Panel (Bottom Sheet style) -->
  <div class="feedback-sheet" [class.visible]="voiceState.isListening || voiceState.transcript">
    <!-- Transcript -->
    @if (voiceState.transcript) {
      <div class="transcript-section">
        <div class="transcript-label">Reconocido:</div>
        <div class="transcript-text">{{ voiceState.transcript }}</div>
        <div class="confidence-bar">
          <div
            class="confidence-fill"
            [style.width.%]="voiceState.confidence * 100"
            [class.high]="voiceState.confidence > 0.8"
            [class.medium]="voiceState.confidence > 0.5 && voiceState.confidence <= 0.8"
            [class.low]="voiceState.confidence <= 0.5">
          </div>
        </div>
      </div>
    }

    <!-- Status Message -->
    <div class="status-message">{{ voiceState.message }}</div>

    <!-- Listening Waves -->
    @if (voiceState.isListening) {
      <div class="listening-waves">
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
      </div>
    }
  </div>

  <!-- FAB Button -->
  <button
    class="voice-fab"
    [class.listening]="voiceState.isListening"
    [class.processing]="voiceState.message.includes('Procesando')"
    (click)="toggleVoiceRecognition()"
    [attr.aria-label]="voiceState.isListening ? 'Detener reconocimiento de voz' : 'Activar control por voz'">
    <mat-icon [class.pulse]="voiceState.isListening">{{ getIcon() }}</mat-icon>
  </button>
</div>
